<?xml version="1.0" encoding="utf-8"?>
<SnapLog xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <SnapList>
    <S Time="2017-05-23T18:21:31.5680399-06:00">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T18:21:31.533" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="83" tet="32290541" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T18:21:31.533" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="83" tet="32290539" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T18:21:31.533" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="83" tet="32290539" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T18:21:31.533" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="83" tet="32290436" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T18:21:31.533" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="83" tet="32290420" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T18:21:31.533" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="83" tet="32290420" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T18:21:31.533" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="83" tet="32290421" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T18:21:31.533" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="83" tet="32287056" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T18:21:31.533" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="83" tet="32290421" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T18:21:31.537" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="83" tet="32290418" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T18:21:31.537" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="83" tet="32288325" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T18:21:31.537" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T18:21:31.537" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="83" tet="32289878" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T18:21:31.54" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="83" tet="32289873" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T18:21:31.54" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="83" tet="32289872" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T18:21:31.54" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="83" tet="32289858" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="83" tet="32289858" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" lbatch="2017-05-23T18:16:58.063" logint="2017-05-23T18:16:58.063" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" lbatch="2017-05-23T18:16:58.063" logint="2017-05-23T18:16:58.063" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" lbatch="2017-05-23T18:16:58.08" logint="2017-05-23T18:16:58.08" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" lbatch="2017-05-23T18:16:58.097" logint="2017-05-23T18:16:58.097" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T18:21:31.54" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:06:57.91" logint="2017-05-23T18:06:57.91" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T18:21:31.543" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="83" tet="32284165" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T18:21:31.543" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="83" tet="32284165" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T18:21:31.543" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="83" tet="32284166" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:17:53.1" logint="2017-05-23T18:17:53.1" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="34" t="2017-05-23T18:21:31.543" cmd="TASK MANAGER" lbatch="2017-05-23T18:08:52.937" logint="2017-05-23T18:08:52.937" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T18:21:31.547" cmd="TASK MANAGER" lbatch="2017-05-23T18:13:53.03" logint="2017-05-23T18:13:53.03" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T18:21:31.547" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="83" tet="32288334" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T18:21:31.547" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="83" tet="32288333" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T18:21:31.547" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="83" tet="32288333" dbname="master" />
        <C server="(local)" SPID="40" t="2017-05-23T18:21:31.547" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="83" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T18:21:31.547" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="83" tet="32288330" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:21:27.07" logint="2017-05-23T18:21:27.067" lwt="MISCELLANEOUS" myid="83" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T18:05:03.66" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>(@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000),@_msparam_3 nvarchar(4000))SELECT
p.name AS [Name],
CAST(p.value AS sql_variant) AS [Value]
FROM
sys.tables AS tbl
INNER JOIN sys.check_constraints AS cstr ON cstr.parent_object_id=tbl.object_id
INNER JOIN sys.extended_properties AS p ON p.major_id=cstr.object_id AND p.minor_id=0 AND p.class=1
WHERE
(p.name=@_msparam_0)and((cstr.name=@_msparam_1)and((tbl.name=@_msparam_2 and SCHEMA_NAME(tbl.schema_id)=@_msparam_3)))</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:20:15.903" logint="2017-05-23T18:20:15.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:31.06" logint="2017-05-23T18:21:31.063" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:24.45" logint="2017-05-23T18:21:24.45" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:20:15.907" logint="2017-05-23T18:20:15.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T18:21:31.547" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:30.907" logint="2017-05-23T18:21:30.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T18:21:31.55" end="78" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="Microsoft SQL Server Management Studio - Query" stat="suspended" lbatch="2017-05-23T18:05:52.447" logint="2017-05-23T18:05:41.303" lwt="LCK_M_IS" Blocked="66" myid="83" tet="939058" dbname="BBInfinity_Demo">
          <SQL>select top 1000 * from dbo.REVENUELETTER</SQL>
          <SQLInput>select top 1000 * from dbo.REVENUELETTER</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T18:21:31.55" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:28.223" logint="2017-05-23T18:21:28.187" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T18:21:31.55" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:20:31.707" logint="2017-05-23T18:20:31.707" lwt="MISCELLANEOUS" myid="83" dbname="ReportServer">
          <SQLInput>ReportServer.dbo.GetDBVersion;1</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T18:21:31.55" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T18:21:31.55" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T18:05:03.603" logint="2017-05-23T18:05:03.533" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>select @@spid;
select SERVERPROPERTY('ProductLevel');
</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T18:21:31.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:30.907" logint="2017-05-23T18:21:30.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T18:21:31.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:30.907" logint="2017-05-23T18:21:30.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T18:21:31.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T18:21:31.553" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="runnable" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="83" tet="2282440" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'8DAB6A06-92F4-4395-A39D-CA9BD214B9A5'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'7A180C71-4A6B-4D3B-918E-7A3FB8A9C50B'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="67" t="2017-05-23T18:21:31.56" start="2" end="1546" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="INSERT" pname="Blackbaud App Server" stat="running" lbatch="2017-05-23T18:21:24.687" logint="2017-05-23T18:21:24.567" lwt="SOS_SCHEDULER_YIELD" myid="83" tet="6868" dbname="BBInfinity_Demo">
          <SQL> insert into dbo.[EXPORT_a2c1c4bd_4873_4287_9f47_98b5743d99a2]  
([Name],  
[Address (Primary)\Address],  
[Address (Primary)\City],  
[Address (Primary)\ZIP],  
[QUERYRECID]) select  distinct 	[V_QUERY_CONSTITUENT].[NAME] as [Name], 
	[V_QUERY_CONSTITUENT\Address (Primary)].[ADDRESSBLOCK] as [Address (Primary)\Address], 
	[V_QUERY_CONSTITUENT\Address (Primary)].[CITY] as [Address (Primary)\City], 
	[V_QUERY_CONSTITUENT\Address (Primary)].[POSTCODE] as [Address (Primary)\ZIP], 
[V_QUERY_CONSTITUENT].[ID] as [QUERYRECID] 
from [dbo].[V_QUERY_CONSTITUENT] as [V_QUERY_CONSTITUENT] 
left outer join [dbo].[V_QUERY_CONSTITUENTPRIMARYADDRESS] as [V_QUERY_CONSTITUENT\Address (Primary)] on [V_QUERY_CONSTITUENT].[ID] = [V_QUERY_CONSTITUENT\Address (Primary)].[CONSTITUENTID] 
</SQL>
          <SQLInput>insert into dbo.[EXPORT_a2c1c4bd_4873_4287_9f47_98b5743d99a2] 
([Name], 
[Address (Primary)\Address], 
[Address (Primary)\City], 
[Address (Primary)\ZIP], 
[QUERYRECID]) select  distinct 	[V_QUERY_CONSTITUENT].[NAME] as [Name],
	[V_QUERY_CONSTITUENT\Address (Primary)].[ADDRESSBLOCK] as [Address (Primary)\Address],
	[V_QUERY_CONSTITUENT\Address (Primary)].[CITY] as [Address (Primary)\City],
	[V_QUERY_CONSTITUENT\Address (Primary)].[POSTCODE] as [Address (Primary)\ZIP],
[V_QUERY_CONSTITUENT].[ID] as [QUERYRECID]
from [dbo].[V_QUERY_CONSTITUENT] as [V_QUERY_CONSTITUENT]
left outer join [dbo].[V_QUERY_CONSTITUENTPRIMARYADDRESS] as [V_QUERY_CONSTITUENT\Address (Primary)] on [V_QUERY_CONSTITUENT].[ID] = [V_QUERY_CONSTITUENT\Address (Primary)].[CONSTITUENTID]
</SQLInput>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T18:21:31.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:00.907" logint="2017-05-23T18:21:00.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T18:21:31.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:20:15.907" logint="2017-05-23T18:20:15.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server Query" lbatch="2017-05-23T18:21:15.657" logint="2017-05-23T18:21:15.423" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>-- SQL Generated by AdHocQuerySqlBuilder.BuildSql
-- User: BLACKBAUD\DavidHe
declare @MAXROWS int;
set @MAXROWS = 31;
with QVROWNUM_CTE as (select QVROWNUMINNER_CTE.*, 
row_number() over(order by [Name] asc) QUERYROWNUMBER from (
select 	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[NAME] as [Name],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[ID] as [ID],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[OWNERID] as [Owner ID],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[ADHOCQUERYID] as [Ad-hoc query ID],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[SMARTQUERYINSTANCEID] as [Smart query instance ID],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[DESCRIPTION] as [Description],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[EXPORTTYPE] as [Export type],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[QUERYSELECTION] as [Query / Selection],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[EXPORTDEFINITION] as [Export definition],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[LASTRUNBY_USERNAME] as [Last run by],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[LASTRUNDATE] as [Last run date],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[LASTRUNSTATUS] as [Last run status],
	[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT].[SITES] as [Sites]
from dbo.[UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT](default,default,N'f85c84e0-c486-4d80-91b7-909f04302f6c',default,default) as [UFN_QUERY_EXPORTPROCESSLISTNOCONTEXT]
) QVROWNUMINNER_CTE 
) select top(@MAXROWS) QVROWNUMBERDATA_SUBSELECT.QVPAGINGFULRESULTCOUNT, QVROWNUM_CTE.* from QVROWNUM_CTE
outer apply (select count(*) [QVPAGINGFULRESULTCOUNT] from QVROWNUM_CTE) QVROWNUMBERDATA_SUBSELECT
where QVROWNUM_CTE.QUERYROWNUMBER between 1 and 30
order by [Name] asc


</SQLInput>
        </C>
        <C server="(local)" SPID="71" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:31.513" logint="2017-05-23T18:21:31.513" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.EXPORTPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:30.907" logint="2017-05-23T18:21:30.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:30.907" logint="2017-05-23T18:21:30.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:24.687" logint="2017-05-23T18:21:24.457" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="75" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server Business Process" lbatch="2017-05-23T18:21:24.683" logint="2017-05-23T18:21:24.677" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESS_CREATEOUTPUTTABLE;1</SQLInput>
        </C>
        <C server="(local)" SPID="76" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:31.513" logint="2017-05-23T18:21:31.517" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_a2c1c4bd_4873_4287_9f47_98b5743d99a2</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:20:15.903" logint="2017-05-23T18:20:15.907" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:28.18" logint="2017-05-23T18:21:28.183" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="79" t="2017-05-23T18:21:31.563" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:20:16.06" logint="2017-05-23T18:20:16.06" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="80" t="2017-05-23T18:21:31.567" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:21:31.063" logint="2017-05-23T18:21:31.063" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="81" t="2017-05-23T18:21:31.567" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:20:25.82" logint="2017-05-23T18:20:25.823" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@now datetime,@id nvarchar(4000))update [HangFire].Server set LastHeartbeat = @now where Id = @id</SQLInput>
        </C>
        <C server="(local)" SPID="82" t="2017-05-23T18:21:31.567" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:21:26.057" logint="2017-05-23T18:21:26.057" lwt="MISCELLANEOUS" myid="83" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="83" t="2017-05-23T18:21:31.567" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T18:21:31.567" logint="2017-05-23T18:21:31.533" lwt="MISCELLANEOUS" myid="83" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
      </SnapShots>
    </S>
  </SnapList>
</SnapLog>