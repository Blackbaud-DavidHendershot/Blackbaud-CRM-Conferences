<?xml version="1.0" encoding="utf-8"?>
<SnapLog xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
  <SnapList>
    <S Time="2017-05-23T17:59:12.3148323-06:00">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T17:59:12.307" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="58" tet="30951439" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T17:59:12.31" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="58" tet="30951440" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T17:59:12.31" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="58" tet="30951440" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T17:59:12.31" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="58" tet="30951337" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T17:59:12.31" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="58" tet="30951321" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T17:59:12.31" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="58" tet="30951321" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T17:59:12.31" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="58" tet="30951321" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T17:59:12.31" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="58" tet="30947957" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T17:59:12.31" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="58" tet="30951322" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T17:59:12.31" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="58" tet="30951318" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T17:59:12.31" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="58" tet="30949223" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T17:59:12.31" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T17:59:12.31" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="58" tet="30950776" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T17:59:12.31" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="58" tet="30950771" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T17:59:12.31" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="58" tet="30950770" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T17:59:12.31" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="58" tet="30950755" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T17:59:12.31" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="58" tet="30950755" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T17:59:12.31" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T17:59:12.31" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:22.62" logint="2017-05-23T17:51:22.62" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T17:59:12.313" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="58" tet="30945060" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T17:59:12.313" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="58" tet="30945060" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T17:59:12.313" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="58" tet="30945060" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="33" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:52.62" logint="2017-05-23T17:51:52.62" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="36" t="2017-05-23T17:59:12.313" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T17:59:12.313" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="58" tet="30949228" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T17:59:12.313" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="58" tet="30949227" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T17:59:12.313" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="58" tet="30949227" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T17:59:12.317" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="58" tet="30949224" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T17:58:31.313" logint="2017-05-23T17:58:31.32" lwt="MISCELLANEOUS" myid="58" dbname="ReportServer">
          <SQLInput>ReportServer.dbo.GetDBVersion;1</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T17:18:03.637" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="58" dbname="master">
          <SQLInput>SELECT
CAST(db_name() AS sysname) AS [Name],
'DatabaseXEStore[@Name=' + quotename(CAST(db_name() AS sysname),'''') +' and @ServerName=' + quotename(CAST(SERVERPROPERTY('servername') AS sysname),'''') + ']' AS [Urn]
ORDER BY
[Name] ASC</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:01.55" logint="2017-05-23T17:59:00.543" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.17" logint="2017-05-23T17:59:00.18" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:58:21.873" logint="2017-05-23T17:58:21.877" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.243" logint="2017-05-23T17:59:00.253" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.243" logint="2017-05-23T17:59:00.253" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T17:59:12.317" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T17:59:12.317" logint="2017-05-23T17:59:12.283" lwt="MISCELLANEOUS" myid="58" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:58:57.47" logint="2017-05-23T17:58:57.46" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T17:59:03.673" logint="2017-05-23T17:59:03.683" lwt="MISCELLANEOUS" myid="58" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Active User Monitoring" lbatch="2017-05-23T17:58:48.55" logint="2017-05-23T17:58:48.547" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>insert bulk dbo.ACTIVEUSERMONITORINGLOG ([ID] UniqueIdentifier, [APPUSERID] UniqueIdentifier, [SESSIONSTART] DateTime, [SESSIONEND] DateTime, [DATEADDED] DateTime)</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.17" logint="2017-05-23T17:59:00.18" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T17:59:12.317" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.243" logint="2017-05-23T17:59:00.253" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T17:59:12.32" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T17:59:12.32" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="58" tet="943330" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'D693F633-DC1B-4804-BBE0-4B9E8D83FCCF'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'458E5539-EF17-4AFC-9DD9-871498EB1D86'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="67" t="2017-05-23T17:59:12.323" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:09.913" logint="2017-05-23T17:59:09.917" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T17:59:12.323" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.243" logint="2017-05-23T17:59:00.253" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T17:59:12.323" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.17" logint="2017-05-23T17:59:00.18" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T17:59:12.323" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:58:57.457" logint="2017-05-23T17:58:57.45" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="71" t="2017-05-23T17:59:12.323" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T17:42:03.66" logint="2017-05-23T17:41:17.2" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select
    FT.ID
    ,FT.TYPECODE
    ,FT.DATE
    ,case REX.GIVENANONYMOUSLY when 1 then 'Yes' else 'No' end as GIVENANONYMOUSLY
    ,FT.CONSTITUENTID
    ,FT.TRANSACTIONAMOUNT
    ,REX.RECEIPTAMOUNT
    ,case REX.BENEFITSWAIVED when 1 then 'Yes' else 'No' end as BENEFITSWAIVED
    ,FT.TRANSACTIONCURRENCYID
    ,REX.APPEALID
  from dbo.FINANCIALTRANSACTION as FT
  inner join dbo.REVENUE_EXT as REX ON FT.ID = REX.ID
  where
    FT.ID not in (select ID FROM REVENUE_EXT where donotacknowledge = 1)
    --REVENUE_EXT.DONOTACKNOWLEDGE = 0
    and FT.TYPECODE != 3
    and (FT.TYPECODE &lt; 10 or FT.TYPECODE = 15)
    and FT.DELETEDON is null</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T17:59:12.327" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.243" logint="2017-05-23T17:59:00.253" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T17:59:12.327" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:00.537" logint="2017-05-23T17:59:00.543" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000))select Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T17:59:12.327" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:56:34.617" logint="2017-05-23T17:56:34.617" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_SCHEMA_DB_GETHOSTINGLINKINFO;1</SQLInput>
        </C>
        <C server="(local)" SPID="75" t="2017-05-23T17:59:12.327" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:09.913" logint="2017-05-23T17:59:09.917" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="76" t="2017-05-23T17:59:12.327" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Active User Monitoring" lbatch="2017-05-23T17:58:48.557" logint="2017-05-23T17:58:48.557" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>insert bulk dbo.ACTIVEUSERMONITORINGLOG ([ID] UniqueIdentifier, [APPUSERID] UniqueIdentifier, [SESSIONSTART] DateTime, [SESSIONEND] DateTime, [DATEADDED] DateTime)</SQLInput>
        </C>
      </SnapShots>
    </S>
    <S Time="2017-05-23T17:59:35.7168826-06:00" seq="2">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T17:59:35.7" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="58" tet="30974838" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T17:59:35.7" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="58" tet="30974836" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T17:59:35.7" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="58" tet="30974836" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T17:59:35.7" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="58" tet="30974733" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T17:59:35.7" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="58" tet="30974717" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T17:59:35.7" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="58" tet="30974717" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T17:59:35.703" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="58" tet="30974717" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T17:59:35.703" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="58" tet="30971353" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T17:59:35.703" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="58" tet="30974718" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T17:59:35.703" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="58" tet="30974714" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T17:59:35.703" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="58" tet="30972619" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T17:59:35.703" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="58" tet="30974172" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T17:59:35.703" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="58" tet="30974167" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T17:59:35.703" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="58" tet="30974166" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T17:59:35.703" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="58" tet="30974152" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="58" tet="30974152" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:22.62" logint="2017-05-23T17:51:22.62" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T17:59:35.703" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T17:59:35.707" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="58" tet="30968456" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T17:59:35.707" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="58" tet="30968456" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T17:59:35.707" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="58" tet="30968457" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="33" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:52.62" logint="2017-05-23T17:51:52.62" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="36" t="2017-05-23T17:59:35.707" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T17:59:35.707" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="58" tet="30972624" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T17:59:35.707" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TO_FLUSH" myid="58" tet="30972623" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T17:59:35.707" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="58" tet="30972623" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T17:59:35.707" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="58" tet="30972620" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T17:59:35.707" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T17:59:31.34" logint="2017-05-23T17:59:31.343" lwt="MISCELLANEOUS" myid="58" dbname="ReportServer">
          <SQLInput>ReportServer.dbo.GetDBVersion;1</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T17:59:35.707" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T17:18:03.637" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="58" dbname="master">
          <SQLInput>SELECT
CAST(db_name() AS sysname) AS [Name],
'DatabaseXEStore[@Name=' + quotename(CAST(db_name() AS sysname),'''') +' and @ServerName=' + quotename(CAST(SERVERPROPERTY('servername') AS sysname),'''') + ']' AS [Urn]
ORDER BY
[Name] ASC</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T17:59:35.707" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.34" logint="2017-05-23T17:59:30.343" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T17:59:35.707" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.277" logint="2017-05-23T17:59:30.28" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:58:21.873" logint="2017-05-23T17:58:21.877" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.277" logint="2017-05-23T17:59:30.28" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.213" logint="2017-05-23T17:59:30.217" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T17:59:35.71" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T17:59:35.71" logint="2017-05-23T17:59:35.7" lwt="MISCELLANEOUS" myid="58" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:34.417" logint="2017-05-23T17:59:27.487" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T17:59:33.96" logint="2017-05-23T17:59:33.967" lwt="MISCELLANEOUS" myid="58" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Active User Monitoring" lbatch="2017-05-23T17:58:48.55" logint="2017-05-23T17:58:48.547" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>insert bulk dbo.ACTIVEUSERMONITORINGLOG ([ID] UniqueIdentifier, [APPUSERID] UniqueIdentifier, [SESSIONSTART] DateTime, [SESSIONEND] DateTime, [DATEADDED] DateTime)</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.213" logint="2017-05-23T17:59:30.217" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.277" logint="2017-05-23T17:59:30.28" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T17:59:35.71" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="58" tet="966726" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'8D0747BF-00BB-469F-9683-21C4D10B96F9'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'A8CF51A1-9666-4911-943C-EE2B2DBE91DC'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="67" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:33.89" logint="2017-05-23T17:59:33.89" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.213" logint="2017-05-23T17:59:30.217" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.34" logint="2017-05-23T17:59:30.343" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T17:59:35.71" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:27.493" logint="2017-05-23T17:59:27.487" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="71" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T17:42:03.66" logint="2017-05-23T17:41:17.2" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select
    FT.ID
    ,FT.TYPECODE
    ,FT.DATE
    ,case REX.GIVENANONYMOUSLY when 1 then 'Yes' else 'No' end as GIVENANONYMOUSLY
    ,FT.CONSTITUENTID
    ,FT.TRANSACTIONAMOUNT
    ,REX.RECEIPTAMOUNT
    ,case REX.BENEFITSWAIVED when 1 then 'Yes' else 'No' end as BENEFITSWAIVED
    ,FT.TRANSACTIONCURRENCYID
    ,REX.APPEALID
  from dbo.FINANCIALTRANSACTION as FT
  inner join dbo.REVENUE_EXT as REX ON FT.ID = REX.ID
  where
    FT.ID not in (select ID FROM REVENUE_EXT where donotacknowledge = 1)
    --REVENUE_EXT.DONOTACKNOWLEDGE = 0
    and FT.TYPECODE != 3
    and (FT.TYPECODE &lt; 10 or FT.TYPECODE = 15)
    and FT.DELETEDON is null</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.213" logint="2017-05-23T17:59:30.217" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.213" logint="2017-05-23T17:59:30.217" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:56:34.617" logint="2017-05-23T17:56:34.617" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_SCHEMA_DB_GETHOSTINGLINKINFO;1</SQLInput>
        </C>
        <C server="(local)" SPID="75" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:33.89" logint="2017-05-23T17:59:33.89" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="76" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Active User Monitoring" lbatch="2017-05-23T17:58:48.557" logint="2017-05-23T17:58:48.557" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>insert bulk dbo.ACTIVEUSERMONITORINGLOG ([ID] UniqueIdentifier, [APPUSERID] UniqueIdentifier, [SESSIONSTART] DateTime, [SESSIONEND] DateTime, [DATEADDED] DateTime)</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.277" logint="2017-05-23T17:59:30.28" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:28.5" logint="2017-05-23T17:59:28.5" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration" />
        <C server="(local)" SPID="79" t="2017-05-23T17:59:35.713" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T17:59:30.277" logint="2017-05-23T17:59:30.28" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
      </SnapShots>
    </S>
    <S Time="2017-05-23T18:01:44.5583859-06:00" seq="3">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T18:01:44.547" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="58" tet="31103648" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T18:01:44.547" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="58" tet="31103646" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T18:01:44.547" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="58" tet="31103646" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T18:01:44.547" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="58" tet="31103543" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T18:01:44.547" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="58" tet="31103527" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T18:01:44.547" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="58" tet="31103527" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T18:01:44.547" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="58" tet="31103527" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T18:01:44.547" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="58" tet="31100163" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T18:01:44.547" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="58" tet="31103528" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T18:01:44.547" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="58" tet="31103524" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T18:01:44.547" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="58" tet="31101430" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T18:01:44.55" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="58" tet="31102982" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T18:01:44.55" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="58" tet="31102978" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T18:01:44.55" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="58" tet="31102977" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T18:01:44.55" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="58" tet="31102962" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="58" tet="31102962" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:22.62" logint="2017-05-23T17:51:22.62" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T18:01:44.55" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="58" tet="31097267" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T18:01:44.55" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="58" tet="31097267" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T18:01:44.55" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="58" tet="31097267" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="33" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:52.62" logint="2017-05-23T17:51:52.62" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="36" t="2017-05-23T18:01:44.55" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="58" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T18:01:44.55" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="58" tet="31101435" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T18:01:44.553" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="58" tet="31101433" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T18:01:44.553" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="58" tet="31101433" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T18:01:44.553" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="58" tet="31101431" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:01:35.097" logint="2017-05-23T18:01:35.11" lwt="MISCELLANEOUS" myid="58" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T17:18:03.637" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="58" dbname="master">
          <SQLInput>SELECT
CAST(db_name() AS sysname) AS [Name],
'DatabaseXEStore[@Name=' + quotename(CAST(db_name() AS sysname),'''') +' and @ServerName=' + quotename(CAST(SERVERPROPERTY('servername') AS sysname),'''') + ']' AS [Urn]
ORDER BY
[Name] ASC</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.29" logint="2017-05-23T18:01:30.303" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.35" logint="2017-05-23T18:01:30.367" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:01:41.91" logint="2017-05-23T18:01:41.917" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:00:00.233" logint="2017-05-23T18:00:00.24" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.35" logint="2017-05-23T18:01:30.367" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T18:01:44.553" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T18:01:44.553" logint="2017-05-23T18:01:44.543" lwt="MISCELLANEOUS" myid="58" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:01:27.57" logint="2017-05-23T18:01:27.557" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:01:31.393" logint="2017-05-23T18:01:31.397" lwt="MISCELLANEOUS" myid="58" dbname="ReportServer">
          <SQLInput>ReportServer.dbo.GetMyRunningJobs;1</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Active User Monitoring" lbatch="2017-05-23T17:58:48.55" logint="2017-05-23T17:58:48.547" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>insert bulk dbo.ACTIVEUSERMONITORINGLOG ([ID] UniqueIdentifier, [APPUSERID] UniqueIdentifier, [SESSIONSTART] DateTime, [SESSIONEND] DateTime, [DATEADDED] DateTime)</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.413" logint="2017-05-23T18:01:30.43" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.417" logint="2017-05-23T18:01:30.43" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T18:01:44.553" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T18:01:44.557" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="58" tet="1095536" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'B0FC0F49-D403-49F2-92EF-2FE0D820BFC7'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'95193CE3-4030-4316-BDDC-84E130A85829'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="67" t="2017-05-23T18:01:44.557" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:01:41.91" logint="2017-05-23T18:01:41.917" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.29" logint="2017-05-23T18:01:30.303" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.35" logint="2017-05-23T18:01:30.367" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:01:27.553" logint="2017-05-23T18:01:27.557" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="71" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T17:42:03.66" logint="2017-05-23T17:41:17.2" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>select
    FT.ID
    ,FT.TYPECODE
    ,FT.DATE
    ,case REX.GIVENANONYMOUSLY when 1 then 'Yes' else 'No' end as GIVENANONYMOUSLY
    ,FT.CONSTITUENTID
    ,FT.TRANSACTIONAMOUNT
    ,REX.RECEIPTAMOUNT
    ,case REX.BENEFITSWAIVED when 1 then 'Yes' else 'No' end as BENEFITSWAIVED
    ,FT.TRANSACTIONCURRENCYID
    ,REX.APPEALID
  from dbo.FINANCIALTRANSACTION as FT
  inner join dbo.REVENUE_EXT as REX ON FT.ID = REX.ID
  where
    FT.ID not in (select ID FROM REVENUE_EXT where donotacknowledge = 1)
    --REVENUE_EXT.DONOTACKNOWLEDGE = 0
    and FT.TYPECODE != 3
    and (FT.TYPECODE &lt; 10 or FT.TYPECODE = 15)
    and FT.DELETEDON is null</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.35" logint="2017-05-23T18:01:30.367" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.29" logint="2017-05-23T18:01:30.303" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="75" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:41.903" logint="2017-05-23T17:59:41.903" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="76" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Active User Monitoring" lbatch="2017-05-23T17:58:48.557" logint="2017-05-23T17:58:48.557" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>insert bulk dbo.ACTIVEUSERMONITORINGLOG ([ID] UniqueIdentifier, [APPUSERID] UniqueIdentifier, [SESSIONSTART] DateTime, [SESSIONEND] DateTime, [DATEADDED] DateTime)</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.29" logint="2017-05-23T18:01:30.303" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:59:28.5" logint="2017-05-23T17:59:28.5" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration" />
        <C server="(local)" SPID="79" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.35" logint="2017-05-23T18:01:30.367" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="80" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.29" logint="2017-05-23T18:01:30.303" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="81" t="2017-05-23T18:01:44.56" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:01:30.29" logint="2017-05-23T18:01:30.303" lwt="MISCELLANEOUS" myid="58" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
      </SnapShots>
    </S>
    <S Time="2017-05-23T18:05:55.8953708-06:00" seq="4">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T18:05:55.88" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="70" tet="31354927" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T18:05:55.88" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="70" tet="31354925" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T18:05:55.88" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="70" tet="31354925" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T18:05:55.88" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="70" tet="31354822" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T18:05:55.883" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="70" tet="31354807" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T18:05:55.883" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="70" tet="31354807" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T18:05:55.883" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="70" tet="31354807" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T18:05:55.883" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="70" tet="31351442" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T18:05:55.883" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="70" tet="31354807" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T18:05:55.883" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="70" tet="31354803" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T18:05:55.883" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31352709" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T18:05:55.883" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="70" tet="31354261" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T18:05:55.883" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="70" tet="31354256" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T18:05:55.883" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="70" tet="31354256" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T18:05:55.883" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="70" tet="31354241" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="70" tet="31354241" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T18:05:55.883" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:22.62" logint="2017-05-23T17:51:22.62" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T18:05:55.887" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="70" tet="31348545" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T18:05:55.887" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="70" tet="31348546" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T18:05:55.887" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="70" tet="31348546" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="33" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:52.62" logint="2017-05-23T17:51:52.62" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="34" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="36" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T18:05:55.887" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="70" tet="31352714" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T18:05:55.887" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="70" tet="31352713" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T18:05:55.887" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31352712" dbname="master" />
        <C server="(local)" SPID="40" t="2017-05-23T18:05:55.887" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T18:05:55.887" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="70" tet="31352710" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T18:05:55.887" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:05:31.463" logint="2017-05-23T18:05:31.467" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>ReportServer.dbo.GetMyRunningJobs;1</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T18:05:03.66" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000),@_msparam_3 nvarchar(4000))SELECT
p.name AS [Name],
CAST(p.value AS sql_variant) AS [Value]
FROM
sys.tables AS tbl
INNER JOIN sys.check_constraints AS cstr ON cstr.parent_object_id=tbl.object_id
INNER JOIN sys.extended_properties AS p ON p.major_id=cstr.object_id AND p.minor_id=0 AND p.class=1
WHERE
(p.name=@_msparam_0)and((cstr.name=@_msparam_1)and((tbl.name=@_msparam_2 and SCHEMA_NAME(tbl.schema_id)=@_msparam_3)))</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.483" logint="2017-05-23T18:05:45.497" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.483" logint="2017-05-23T18:05:45.497" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:53.99" logint="2017-05-23T18:05:54.003" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.483" logint="2017-05-23T18:05:45.497" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.547" logint="2017-05-23T18:05:45.56" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T18:05:55.89" end="78" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="Microsoft SQL Server Management Studio - Query" stat="suspended" lbatch="2017-05-23T18:05:52.447" logint="2017-05-23T18:05:41.303" lwt="LCK_M_IS" Blocked="66" myid="70" tet="3437" dbname="BBInfinity_Demo">
          <SQL>select top 1000 * from dbo.REVENUELETTER</SQL>
          <SQLInput>select top 1000 * from dbo.REVENUELETTER</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:27.72" logint="2017-05-23T18:05:27.72" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:05:47.827" logint="2017-05-23T18:05:47.833" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T18:05:03.603" logint="2017-05-23T18:05:03.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select @@spid;
select SERVERPROPERTY('ProductLevel');
</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.547" logint="2017-05-23T18:05:45.56" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:00.46" logint="2017-05-23T18:05:00.467" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T18:05:55.89" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T18:05:55.893" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="70" tet="1346817" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'FA5A2255-6313-5168-3157-D1E847C26E7E'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'8F40BE0B-08C3-413F-A17B-85ACE3D43741'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="67" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:04:01.953" logint="2017-05-23T18:04:01.94" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:55.623" logint="2017-05-23T18:05:55.63" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@now datetime,@id nvarchar(4000))update [HangFire].Server set LastHeartbeat = @now where Id = @id</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.547" logint="2017-05-23T18:05:45.56" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T18:05:55.893" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T18:05:55.893" logint="2017-05-23T18:05:55.88" lwt="MISCELLANEOUS" myid="70" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.547" logint="2017-05-23T18:05:45.56" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.483" logint="2017-05-23T18:05:45.497" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:53.99" logint="2017-05-23T18:05:53.987" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.547" logint="2017-05-23T18:05:45.56" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:27.733" logint="2017-05-23T18:05:27.72" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="79" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.61" logint="2017-05-23T18:05:45.623" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="80" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.483" logint="2017-05-23T18:05:45.497" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="81" t="2017-05-23T18:05:55.893" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:45.547" logint="2017-05-23T18:05:45.56" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
      </SnapShots>
    </S>
    <S Time="2017-05-23T18:06:19.02361-06:00" seq="5">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T18:06:19" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="70" tet="31378045" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T18:06:19" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="70" tet="31378043" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T18:06:19" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="70" tet="31378043" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T18:06:19" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="70" tet="31377940" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T18:06:19" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="70" tet="31377924" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T18:06:19" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="70" tet="31377924" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T18:06:19.003" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="70" tet="31377924" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T18:06:19.003" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="70" tet="31374560" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T18:06:19.003" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="70" tet="31377925" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T18:06:19.003" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="70" tet="31377921" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T18:06:19.003" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31375826" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T18:06:19.003" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="70" tet="31377379" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T18:06:19.003" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="70" tet="31377374" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T18:06:19.003" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="70" tet="31377373" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T18:06:19.003" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="70" tet="31377359" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="70" tet="31377359" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:22.62" logint="2017-05-23T17:51:22.62" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T18:06:19.003" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T18:06:19.007" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="70" tet="31371663" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T18:06:19.007" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="70" tet="31371663" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T18:06:19.007" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="70" tet="31371664" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="33" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:52.62" logint="2017-05-23T17:51:52.62" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="34" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="36" t="2017-05-23T18:06:19.007" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T18:06:19.007" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="70" tet="31375832" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T18:06:19.01" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="70" tet="31375831" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T18:06:19.01" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31375831" dbname="master" />
        <C server="(local)" SPID="40" t="2017-05-23T18:06:19.01" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T18:06:19.01" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="70" tet="31375829" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:06:18.05" logint="2017-05-23T18:06:18.053" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T18:05:03.66" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000),@_msparam_3 nvarchar(4000))SELECT
p.name AS [Name],
CAST(p.value AS sql_variant) AS [Value]
FROM
sys.tables AS tbl
INNER JOIN sys.check_constraints AS cstr ON cstr.parent_object_id=tbl.object_id
INNER JOIN sys.extended_properties AS p ON p.major_id=cstr.object_id AND p.minor_id=0 AND p.class=1
WHERE
(p.name=@_msparam_0)and((cstr.name=@_msparam_1)and((tbl.name=@_msparam_2 and SCHEMA_NAME(tbl.schema_id)=@_msparam_3)))</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.61" logint="2017-05-23T18:06:15.627" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:06:17.987" logint="2017-05-23T18:06:17.99" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T18:06:19.01" end="78" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="Microsoft SQL Server Management Studio - Query" stat="suspended" lbatch="2017-05-23T18:05:52.447" logint="2017-05-23T18:05:41.303" lwt="LCK_M_IS" Blocked="66" myid="70" tet="26556" dbname="BBInfinity_Demo">
          <SQL>select top 1000 * from dbo.REVENUELETTER</SQL>
          <SQLInput>select top 1000 * from dbo.REVENUELETTER</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:57.733" logint="2017-05-23T18:05:57.737" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T18:06:19.01" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:05:47.827" logint="2017-05-23T18:05:47.833" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T18:06:19.013" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T18:06:19.013" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T18:05:03.603" logint="2017-05-23T18:05:03.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select @@spid;
select SERVERPROPERTY('ProductLevel');
</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T18:06:19.013" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T18:06:19.013" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:00.46" logint="2017-05-23T18:05:00.467" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T18:06:19.013" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T18:06:19.013" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="70" tet="1369937" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'72938B0B-6594-4FA5-BA8D-CC4A840257CC'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'1681299A-618F-48C4-826F-641AD35C0431'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.613" logint="2017-05-23T18:06:15.627" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T18:06:19.017" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T18:06:19.017" logint="2017-05-23T18:06:19.007" lwt="MISCELLANEOUS" myid="70" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:06:17.987" logint="2017-05-23T18:06:17.99" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:57.747" logint="2017-05-23T18:05:57.737" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="79" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="80" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="81" t="2017-05-23T18:06:19.017" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
      </SnapShots>
    </S>
    <S Time="2017-05-23T18:06:23.2977666-06:00" seq="6">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T18:06:23.273" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="70" tet="31382323" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T18:06:23.273" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="70" tet="31382321" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T18:06:23.273" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="70" tet="31382321" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T18:06:23.273" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="70" tet="31382218" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T18:06:23.273" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="70" tet="31382202" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T18:06:23.273" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="70" tet="31382202" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T18:06:23.273" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="70" tet="31382202" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T18:06:23.273" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="70" tet="31378838" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T18:06:23.273" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="70" tet="31382203" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T18:06:23.273" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="70" tet="31382199" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T18:06:23.273" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31380104" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T18:06:23.273" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T18:06:23.277" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="70" tet="31381657" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T18:06:23.277" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="70" tet="31381652" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T18:06:23.277" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="70" tet="31381651" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T18:06:23.277" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="70" tet="31381637" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="70" tet="31381637" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:22.62" logint="2017-05-23T17:51:22.62" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="25" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T18:06:23.277" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="70" tet="31375941" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T18:06:23.277" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="70" tet="31375941" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T18:06:23.277" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="70" tet="31375942" dbname="master" />
        <C server="(local)" SPID="29" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="30" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:57:52.687" logint="2017-05-23T17:57:52.687" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="31" t="2017-05-23T18:06:23.277" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="32" t="2017-05-23T18:06:23.28" cmd="TASK MANAGER" lbatch="2017-05-23T17:58:52.693" logint="2017-05-23T17:58:52.693" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="33" t="2017-05-23T18:06:23.28" cmd="TASK MANAGER" lbatch="2017-05-23T17:51:52.62" logint="2017-05-23T17:51:52.62" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="34" t="2017-05-23T18:06:23.28" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="35" t="2017-05-23T18:06:23.28" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="36" t="2017-05-23T18:06:23.28" cmd="TASK MANAGER" lbatch="2017-05-23T17:53:52.627" logint="2017-05-23T17:53:52.627" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T18:06:23.28" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="70" tet="31380110" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T18:06:23.28" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="70" tet="31380108" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T18:06:23.28" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31380108" dbname="master" />
        <C server="(local)" SPID="40" t="2017-05-23T18:06:23.28" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T18:06:23.28" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="70" tet="31380106" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:06:18.05" logint="2017-05-23T18:06:18.053" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T18:05:03.66" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000),@_msparam_3 nvarchar(4000))SELECT
p.name AS [Name],
CAST(p.value AS sql_variant) AS [Value]
FROM
sys.tables AS tbl
INNER JOIN sys.check_constraints AS cstr ON cstr.parent_object_id=tbl.object_id
INNER JOIN sys.extended_properties AS p ON p.major_id=cstr.object_id AND p.minor_id=0 AND p.class=1
WHERE
(p.name=@_msparam_0)and((cstr.name=@_msparam_1)and((tbl.name=@_msparam_2 and SCHEMA_NAME(tbl.schema_id)=@_msparam_3)))</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.61" logint="2017-05-23T18:06:15.627" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:06:21.977" logint="2017-05-23T18:06:21.983" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T18:06:23.28" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T18:06:23.283" end="78" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="Microsoft SQL Server Management Studio - Query" stat="suspended" lbatch="2017-05-23T18:05:52.447" logint="2017-05-23T18:05:41.303" lwt="LCK_M_IS" Blocked="66" myid="70" tet="30833" dbname="BBInfinity_Demo">
          <SQL>select top 1000 * from dbo.REVENUELETTER</SQL>
          <SQLInput>select top 1000 * from dbo.REVENUELETTER</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:57.733" logint="2017-05-23T18:05:57.737" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:05:47.827" logint="2017-05-23T18:05:47.833" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T18:05:03.603" logint="2017-05-23T18:05:03.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select @@spid;
select SERVERPROPERTY('ProductLevel');
</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:05:00.46" logint="2017-05-23T18:05:00.467" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T18:06:23.283" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T18:06:23.287" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="70" tet="1374213" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'081C5BA4-EE61-4DD2-AD01-CA65579B2EC3'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'987937EE-A25C-49FA-B680-97EDEE18916D'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.613" logint="2017-05-23T18:06:15.627" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T18:06:23.287" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T18:06:23.287" logint="2017-05-23T18:06:23.283" lwt="MISCELLANEOUS" myid="70" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:06:21.977" logint="2017-05-23T18:06:21.983" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T18:06:23.287" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:05:57.747" logint="2017-05-23T18:05:57.737" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="79" t="2017-05-23T18:06:23.29" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.547" logint="2017-05-23T18:06:15.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="80" t="2017-05-23T18:06:23.29" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="81" t="2017-05-23T18:06:23.29" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:06:15.483" logint="2017-05-23T18:06:15.5" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
      </SnapShots>
    </S>
    <S Time="2017-05-23T18:07:06.2463514-06:00" seq="7">
      <SnapShots>
        <C server="(local)" SPID="1" t="2017-05-23T18:07:06.23" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_PERSIST_TASK_MAIN_LOOP_SLEEP" myid="70" tet="31425271" dbname="master" />
        <C server="(local)" SPID="2" t="2017-05-23T18:07:06.23" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="QDS_CLEANUP_STALE_QUERIES_TASK_M" myid="70" tet="31425269" dbname="master" />
        <C server="(local)" SPID="3" t="2017-05-23T18:07:06.23" cmd="UNKNOWN TOKEN" stat="background" lbatch="2017-05-23T09:23:22.087" logint="2017-05-23T09:23:22.087" lwt="SLEEP_TASK" myid="70" tet="31425269" dbname="master" />
        <C server="(local)" SPID="4" t="2017-05-23T18:07:06.23" cmd="LOG WRITER" stat="background" lbatch="2017-05-23T09:23:22.197" logint="2017-05-23T09:23:22.197" lwt="LOGMGR_QUEUE" myid="70" tet="31425166" dbname="master" />
        <C server="(local)" SPID="5" t="2017-05-23T18:07:06.23" cmd="RECOVERY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DIRTY_PAGE_POLL" myid="70" tet="31425150" dbname="master" />
        <C server="(local)" SPID="6" t="2017-05-23T18:07:06.23" cmd="LAZY WRITER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="LAZYWRITER_SLEEP" myid="70" tet="31425152" dbname="master" />
        <C server="(local)" SPID="7" t="2017-05-23T18:07:06.233" cmd="LOCK MONITOR" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="REQUEST_FOR_DEADLOCK_SEARCH" myid="70" tet="31425152" dbname="master" />
        <C server="(local)" SPID="8" t="2017-05-23T18:07:06.233" cmd="SIGNAL HANDLER" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="KSOURCE_WAKEUP" myid="70" tet="31421788" dbname="master" />
        <C server="(local)" SPID="9" t="2017-05-23T18:07:06.233" cmd="XTP_THREAD_POOL" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="DISPATCHER_QUEUE_SEMAPHORE" myid="70" tet="31425153" dbname="master" />
        <C server="(local)" SPID="10" t="2017-05-23T18:07:06.233" cmd="XTP_CKPT_AGENT" stat="background" lbatch="2017-05-23T09:23:22.21" logint="2017-05-23T09:23:22.21" lwt="WAIT_XTP_HOST_WAIT" myid="70" tet="31425149" dbname="master" />
        <C server="(local)" SPID="11" t="2017-05-23T18:07:06.233" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31423055" dbname="master" />
        <C server="(local)" SPID="12" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T09:23:22.71" logint="2017-05-23T09:23:22.71" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="13" t="2017-05-23T18:07:06.233" cmd="TRACE QUEUE TASK" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SQLTRACE_INCREMENTAL_FLUSH_SLEEP" myid="70" tet="31424607" dbname="master" />
        <C server="(local)" SPID="14" t="2017-05-23T18:07:06.233" cmd="SYSTEM_HEALTH_MO" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="SP_SERVER_DIAGNOSTICS_SLEEP" myid="70" tet="31424602" dbname="master" />
        <C server="(local)" SPID="15" t="2017-05-23T18:07:06.233" cmd="RECEIVE" stat="background" lbatch="2017-05-23T09:23:22.757" logint="2017-05-23T09:23:22.757" lwt="PREEMPTIVE_OS_REPORTEVENT" myid="70" tet="31424602" dbname="master" />
        <C server="(local)" SPID="16" t="2017-05-23T18:07:06.233" cmd="CHECKPOINT" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="CHECKPOINT_QUEUE" myid="70" tet="31424587" dbname="master" />
        <C server="(local)" SPID="17" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" stat="background" lbatch="2017-05-23T09:23:22.773" logint="2017-05-23T09:23:22.773" lwt="ONDEMAND_TASK_QUEUE" myid="70" tet="31424587" dbname="master" />
        <C server="(local)" SPID="18" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T17:56:57.667" logint="2017-05-23T17:56:57.667" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="19" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T17:50:57.617" logint="2017-05-23T17:50:57.617" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="20" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T18:06:57.91" logint="2017-05-23T18:06:57.91" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="21" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T18:06:57.91" logint="2017-05-23T18:06:57.91" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="22" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T18:06:57.91" logint="2017-05-23T18:06:57.91" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="23" t="2017-05-23T18:07:06.233" cmd="TASK MANAGER" lbatch="2017-05-23T18:06:57.91" logint="2017-05-23T18:06:57.91" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="24" t="2017-05-23T18:07:06.237" cmd="TASK MANAGER" lbatch="2017-05-23T18:06:57.91" logint="2017-05-23T18:06:57.91" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="26" t="2017-05-23T18:07:06.237" cmd="XE TIMER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_TIMER_EVENT" myid="70" tet="31418891" dbname="master" />
        <C server="(local)" SPID="27" t="2017-05-23T18:07:06.237" cmd="RESOURCE MONITOR" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="SOS_SCHEDULER_YIELD" myid="70" tet="31418892" dbname="master" />
        <C server="(local)" SPID="28" t="2017-05-23T18:07:06.237" cmd="XE DISPATCHER" stat="background" lbatch="2017-05-23T09:23:28.467" logint="2017-05-23T09:23:28.467" lwt="XE_DISPATCHER_WAIT" myid="70" tet="31418892" dbname="master" />
        <C server="(local)" SPID="37" t="2017-05-23T18:07:06.237" cmd="BRKR EVENT HNDLR" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_EVENTHANDLER" myid="70" tet="31423059" dbname="master" />
        <C server="(local)" SPID="38" t="2017-05-23T18:07:06.237" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="SLEEP_TASK" myid="70" tet="31423058" dbname="master" />
        <C server="(local)" SPID="39" t="2017-05-23T18:07:06.237" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="BROKER_TRANSMITTER" myid="70" tet="31423057" dbname="master" />
        <C server="(local)" SPID="40" t="2017-05-23T18:07:06.237" cmd="TASK MANAGER" lbatch="2017-05-23T18:03:52.833" logint="2017-05-23T18:03:52.833" lwt="MISCELLANEOUS" myid="70" dbname="master" />
        <C server="(local)" SPID="43" t="2017-05-23T18:07:06.237" cmd="BRKR TASK" stat="background" lbatch="2017-05-23T09:23:24.303" logint="2017-05-23T09:23:24.303" lwt="HADR_FILESTREAM_IOMGR_IOCOMPLETI" myid="70" tet="31423055" dbname="master" />
        <C server="(local)" SPID="51" t="2017-05-23T18:07:06.237" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:06:31.51" logint="2017-05-23T18:06:31.523" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>ReportServer.dbo.GetDBVersion;1</SQLInput>
        </C>
        <C server="(local)" SPID="52" t="2017-05-23T18:07:06.237" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio" lbatch="2017-05-23T18:05:03.66" logint="2017-05-23T09:29:16.563" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@_msparam_0 nvarchar(4000),@_msparam_1 nvarchar(4000),@_msparam_2 nvarchar(4000),@_msparam_3 nvarchar(4000))SELECT
p.name AS [Name],
CAST(p.value AS sql_variant) AS [Value]
FROM
sys.tables AS tbl
INNER JOIN sys.check_constraints AS cstr ON cstr.parent_object_id=tbl.object_id
INNER JOIN sys.extended_properties AS p ON p.major_id=cstr.object_id AND p.minor_id=0 AND p.class=1
WHERE
(p.name=@_msparam_0)and((cstr.name=@_msparam_1)and((tbl.name=@_msparam_2 and SCHEMA_NAME(tbl.schema_id)=@_msparam_3)))</SQLInput>
        </C>
        <C server="(local)" SPID="53" t="2017-05-23T18:07:06.237" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.57" logint="2017-05-23T18:07:00.577" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="54" t="2017-05-23T18:07:06.237" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.57" logint="2017-05-23T18:07:00.577" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="55" t="2017-05-23T18:07:06.237" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:07:05.993" logint="2017-05-23T18:07:05.993" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@PARAMETERSETID uniqueidentifier,@CURRENTAPPUSERID uniqueidentifier)select top 1 BPS.ID,
BPS.STATUSCODE,
BPS.STATUS,
BPS.ERRORMESSAGE,
dbo.UFN_APPUSER_CUSTOMAUTHUSERID_OR_USERNAME(STARTEDBY.ID) as USERNAME,
BPS.STARTEDON,
BPS.ENDEDON,
BPS.NUMBERPROCESSED,
BPS.NUMBEROFEXCEPTIONS,
BPS.SERVERNAME,
BPS.BUSINESSPROCESSCATALOGID,
datediff(s, BPS.STARTEDON, coalesce(BPS.ENDEDON, getdate())) as DURATION,
case when BPS.LETTERTEMPLATE is null then 0 else 1 end as HASLETTERTEMPLATE,
case when BPS.LABELTEMPLATE is null then 0 else 1 end as HASLABELTEMPLATE, 
case when exists(select ID from dbo.BUSINESSPROCESSOUTPUT where BUSINESSPROCESSOUTPUT.BUSINESSPROCESSSTATUSID = BPS.ID) then 1 else 0 end OUTPUTTABLEEXISTS, 
cast(case when (dbo.UFN_APPUSER_ISSYSADMIN(@CURRENTAPPUSERID) = 1 or [BPS].[STARTEDBYUSERID] = @CURRENTAPPUSERID) and ([BPS].[STATUSCODE] = 4 and isnull([BPS].[ENQUEUEDJOBID] , 0) &lt;&gt; 0) then 1 else 0 end as bit) [ALLOWREMOVEFROMENQUEUE]
from dbo.BUSINESSPROCESSSTATUS as BPS
inner join dbo.APPUSER as STARTEDBY on STARTEDBY.ID = BPS.STARTEDBYUSERID
inner join dbo.ASSIGNLETTERCODESPROCESSSTATUS as STATUS on STATUS.ID = BPS.ID
where STATUS.PARAMETERSETID = @PARAMETERSETID
order by BPS.STARTEDON desc
</SQLInput>
        </C>
        <C server="(local)" SPID="56" t="2017-05-23T18:07:06.24" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.507" logint="2017-05-23T18:07:00.517" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="57" t="2017-05-23T18:07:06.24" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:01.397" logint="2017-05-23T18:07:00.407" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="58" t="2017-05-23T18:07:06.24" end="78" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="Microsoft SQL Server Management Studio - Query" stat="suspended" lbatch="2017-05-23T18:05:52.447" logint="2017-05-23T18:05:41.303" lwt="LCK_M_IS" Blocked="66" myid="70" tet="73783" dbname="BBInfinity_Demo">
          <SQL>select top 1000 * from dbo.REVENUELETTER</SQL>
          <SQLInput>select top 1000 * from dbo.REVENUELETTER</SQLInput>
        </C>
        <C server="(local)" SPID="59" t="2017-05-23T18:07:06.24" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:06:57.787" logint="2017-05-23T18:06:57.787" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_APPUSER_GETAPPUSERINFO_FROM_USERSID;1</SQLInput>
        </C>
        <C server="(local)" SPID="60" t="2017-05-23T18:07:06.24" host="CHS6DAVIDHEN02" ntuser="NETWORK SERVICE" login="NT AUTHORITY\NETWORK SERVICE" pname="Report Server" lbatch="2017-05-23T18:06:58.463" logint="2017-05-23T18:06:58.47" lwt="MISCELLANEOUS" myid="70" dbname="ReportServer">
          <SQLInput>
                                    declare @BatchID uniqueidentifier

                                    set @BatchID = newid()

                                    UPDATE [Notifications] WITH (TABLOCKX)
                                        SET [BatchID] = @BatchID,
                                        [ProcessStart] = GETUTCDATE(),
                                        [ProcessHeartbeat] = GETUTCDATE()
                                    FROM (
                                        SELECT TOP 8  [NotificationID] FROM [Notifications] WITH (TABLOCKX) WHERE ProcessStart is NULL and
	                                    (ProcessAfter is NULL or ProcessAfter &lt; GETUTCDATE()) ORDER BY [NotificationEntered]
                                    ) AS t1
                                    WHERE [Notifications].[NotificationID] = t1.[NotificationID]

                                    select top 8
		                                    -- Notification data
		                                    N.[NotificationID],
		                                    N.[SubscriptionID],
		                                    N.[ActivationID],
		                                    N.[ReportID],
		                                    N.[SnapShotDate],
		                                    N.[DeliveryExtension],
		                                    N.[ExtensionSettings],
                                            N.[Locale],
		                                    N.[Parameters],
		                                    N.[SubscriptionLastRunTime],
		                                    N.[ProcessStart],
		                                    N.[NotificationEntered],
		                                    N.[Attempt],
		                                    N.[IsDataDriven],
		                                    SUSER_SNAME(Owner.[Sid]),
		                                    Owner.[UserName],
		                                    -- Report Data
		                                    O.[Path],
		                                    N.[ReportZone],
		                                    O.[Type],
		                                    SD.NtSecDescPrimary,
                                            N.[Version],
                                            Owner.[AuthType]
	                                    from 
		                                    [Notifications] N with (TABLOCKX) inner join [Catalog] O on O.[ItemID] = N.[ReportID]
		                                    inner join [Users] Owner on N.SubscriptionOwnerID = Owner.UserID
		                                    left outer join [SecData] SD on O.[PolicyID] = SD.[PolicyID] AND SD.AuthType = Owner.AuthType
	                                    where 
		                                    N.[BatchID] = @BatchID
                                    ORDER BY [NotificationEntered]
</SQLInput>
        </C>
        <C server="(local)" SPID="61" t="2017-05-23T18:07:06.24" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:25.527" logint="2017-05-23T17:43:25.527" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>(@ID uniqueidentifier)select count(1) from dbo.[BUSINESSPROCESSCATALOG] where [ID] = @ID and [ALLOWENQUEUE] = 1;</SQLInput>
        </C>
        <C server="(local)" SPID="62" t="2017-05-23T18:07:06.24" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" pname="Microsoft SQL Server Management Studio - Query" lbatch="2017-05-23T18:05:03.603" logint="2017-05-23T18:05:03.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select @@spid;
select SERVERPROPERTY('ProductLevel');
</SQLInput>
        </C>
        <C server="(local)" SPID="63" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.507" logint="2017-05-23T18:07:00.517" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="64" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.507" logint="2017-05-23T18:07:00.517" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="65" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T17:43:28.957" logint="2017-05-23T17:43:25.533" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>BBInfinity_Demo.dbo.USP_BUSINESSPROCESSSTATUS_UPDATESTATUS;1</SQLInput>
        </C>
        <C server="(local)" SPID="66" t="2017-05-23T18:07:06.243" start="850" end="1474" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" cmd="SELECT" pname="Blackbaud App Server Business Process" stat="running" lbatch="2017-05-23T17:43:28.96" logint="2017-05-23T17:43:25.58" lwt="WRITELOG" myid="70" tet="1417163" dbname="BBInfinity_Demo" objname="[dbo].[UFN_REVENUELETTER_CURRENTCOUNT_2]">
          <SQL> 
		 
			CREATE function dbo.UFN_REVENUELETTER_CURRENTCOUNT_2 
			( 
				@REVENUEID uniqueidentifier, 
				@LETTERCODEID uniqueidentifier, 
				@ACKNOWLEDGEEID uniqueidentifier, 
				-- Including OUTOFDATE since it seems to be needed to trigger 
				-- checking the table constraint 
				@OUTOFDATE bit, 
        @MKTPACKAGEID uniqueidentifier 
			) 
			returns int 
			as 
			begin			 
				declare @COUNT int 
         
				select  
          @COUNT = count(*) 
				from  
          dbo.REVENUELETTER 
				where 
					REVENUEID = @REVENUEID and 
					LETTERCODEID = @LETTERCODEID and 
					(MKTPACKAGEID is null and @MKTPACKAGEID is null or MKTPACKAGEID = @MKTPACKAGEID) and 
					ACKNOWLEDGEEID = @ACKNOWLEDGEEID and 
					OUTOFDATE = 0 
					 
				return @COUNT 
			end 
		 
	</SQL>
          <SQLInput>(@CHANGEAGENTID uniqueidentifier)declare @CURRENTDATE datetime;
set @CURRENTDATE = getdate();
insert into dbo.[REVENUELETTER] ([ID], [REVENUEID], [LETTERCODEID], [ACKNOWLEDGEEID], [ADDEDBYID], [CHANGEDBYID], [DATEADDED], [DATECHANGED])
select newid(), [REVENUEID], [LETTERCODEID], [CONSTITUENTID], @CHANGEAGENTID, @CHANGEAGENTID, @CURRENTDATE, @CURRENTDATE
from dbo.[#TEMP_bfa2c62b_9b43_40c9_8031_5b15b144c482]
</SQLInput>
          <Params>
            <Params>
              <Name>@ACKNOWLEDGEEID</Name>
              <Value>{guid'AC944EFE-B4F9-41B9-9F05-26480A39CB67'}</Value>
            </Params>
            <Params>
              <Name>@MKTPACKAGEID</Name>
              <Value>NULL</Value>
            </Params>
            <Params>
              <Name>@LETTERCODEID</Name>
              <Value>{guid'F0F586BF-9724-4FD2-A087-4E43F51124F2'}</Value>
            </Params>
            <Params>
              <Name>@REVENUEID</Name>
              <Value>{guid'CBD7F3A8-4110-4E0E-9E1A-20F20BD82D68'}</Value>
            </Params>
          </Params>
        </C>
        <C server="(local)" SPID="68" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.57" logint="2017-05-23T18:07:00.577" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="69" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.57" logint="2017-05-23T18:07:00.577" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="70" t="2017-05-23T18:07:06.243" start="1770" end="3406" host="CHS6DAVIDHEN02" ntuser="DavidHe" login="BLACKBAUD\DavidHe" cmd="SELECT" pname="SQLSnap 2006" stat="runnable" lbatch="2017-05-23T18:07:06.243" logint="2017-05-23T18:07:06.23" lwt="MISCELLANEOUS" myid="70" dbname="master">
          <SQL>SQLSnap batch</SQL>
          <SQLInput>(@iSPID int)
/*
SQL Snap Executing Query script

SQL Server 2005 (or Later) Version

****************************************
Copyright 2005-2008 Blackbaud CoreTech
****************************************

****************************************
pdg 7.7.2008
Added database_name to result set 2.
****************************************

*/
declare @h binary(20), @start int, @end int,@cmd varchar(255),@status as varchar(255)
declare @qp xml;

declare @hostname nchar(128)
declare @program_name nchar(128)
declare @loginame nchar(128)
declare @blocked smallint
declare @waittime int
declare @lastwaittype nvarchar(34)
declare @waitresource nchar(32)
declare @dbid smallint
declare @uid smallint
declare @last_batch datetime
declare @login_time datetime
declare @open_tran smallint
declare @nt_username nchar(128)

declare @total_elapsed_time int

select 
@h=dmreq.sql_handle,
@start = coalesce(dmreq.statement_start_offset,0), 
@end = coalesce(dmreq.statement_end_offset,0),
@cmd=sysprocs.cmd,

@status=sysprocs.status,
@hostname=sysprocs.hostname,
@program_name=sysprocs.program_name,
@loginame=sysprocs.loginame,
@blocked =sysprocs.blocked,
@waittime=sysprocs.waittime,
@lastwaittype =sysprocs.lastwaittype,
@waitresource =sysprocs.waitresource,
@dbid =sysprocs.dbid,
@uid =sysprocs.uid,
@last_batch =sysprocs.last_batch,
@login_time =sysprocs.login_time,
@open_tran =sysprocs.open_tran,
@nt_username=sysprocs.nt_username,

@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0)

from master.dbo.sysprocesses as sysprocs
left outer join master.sys.dm_exec_requests as dmreq on sysprocs.SPID= dmreq.session_id
 where sysprocs.spid=@iSPID;

declare @sqlText nvarchar(max);
declare @object_name nvarchar(261); --Length is sysname*2 + '[]' + '[]' + '.'

--Result set 1
if @iSPID &lt;&gt; @@SPID  


begin

	begin try

		select @h=dmreq.sql_handle,
		@start = coalesce(dmreq.statement_start_offset,0), 
		@end = coalesce(dmreq.statement_end_offset,0),
		@total_elapsed_time =coalesce(dmreq.total_elapsed_time,0),	
		@object_name = QUOTENAME(OBJECT_SCHEMA_NAME(sqltext.objectid, sqltext.[dbid])) + '.' + QUOTENAME(OBJECT_NAME(sqltext.objectid, sqltext.[dbid])),
		@sqlText =sqltext.[text],
		@last_batch=start_time,
		@status=status,
		@cmd=command,
		@blocked=blocking_session_id,
		@qp=(select qp.query_plan from sys.dm_exec_query_plan(dmreq.plan_handle) qp)
		
		FROM master.sys.dm_exec_requests as dmreq 
		cross apply master.sys.dm_exec_sql_text(dmreq.sql_handle) as sqltext
		where dmreq.session_id=@iSpid
		
			
	end try
	begin catch
		select @sqlText ='Unable to get current SQL:' +  error_message()	
	end catch

	select @sqlText as sqlStmt

end
else
begin
	select 'SQLSnap batch' as sqlStmt
end

--	select  [text] as sqlStmt	from ::fn_get_sql(@h) as currentsql 

--Result set 2
select getDate() as t, @start as stmt_start ,@end as stmt_end ,
@cmd as cmd ,
@status as status,
@hostname as hostname,
@program_name as program_name,
@loginame as loginame,
@blocked as blocked,
@waittime as waittime,
cast(@lastwaittype as varchar(32)) as lastwaittype,
@waitresource as waitresource,
@dbid as dbid,
@uid as uid,
@last_batch as last_batch,
@login_time as login_time,
@open_tran as open_tran,
@nt_username as nt_username,@@spid as ThisSPID,
coalesce(@total_elapsed_time,0) as [total_elapsed_time],

/* pdg 7.7.2008 SQL Snap enhancement - include the database name */
DB_NAME(@dbid) AS [database_name],

/* DPC 12/06/2010 Return the query plan XML instead of parsing it in SQL. */
@qp as qp,

@object_name as [object_name];

--Result set 3
dbcc inputbuffer (@iSPID)
</SQLInput>
        </C>
        <C server="(local)" SPID="72" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.57" logint="2017-05-23T18:07:00.577" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="73" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.63" logint="2017-05-23T18:07:00.64" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@key nvarchar(4000),@from float,@to float)select top 1 Value from [HangFire].[Set] with (readcommittedlock) where [Key] = @key and Score between @from and @to order by Score</SQLInput>
        </C>
        <C server="(local)" SPID="74" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:07:05.997" logint="2017-05-23T18:07:06.01" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_Demo">
          <SQLInput>select STATUSMESSAGE from ##BUSINESSPROCESSSTATUS_cf1c0ed0_d90f_4f6f_b63b_805ace3a1c23</SQLInput>
        </C>
        <C server="(local)" SPID="77" t="2017-05-23T18:07:06.243" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.57" logint="2017-05-23T18:07:00.577" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="78" t="2017-05-23T18:07:06.247" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname="Blackbaud App Server" lbatch="2017-05-23T18:06:57.8" logint="2017-05-23T18:06:57.787" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>BBInfinity_CRM_Integration.dbo.USP_DATALIST_BUSINESSPROCESSES_SCHEDULEDTORUN;1</SQLInput>
        </C>
        <C server="(local)" SPID="79" t="2017-05-23T18:07:06.247" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.507" logint="2017-05-23T18:07:00.517" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
        <C server="(local)" SPID="80" t="2017-05-23T18:07:06.247" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.633" logint="2017-05-23T18:07:00.64" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>sys.sp_releaseapplock;1</SQLInput>
        </C>
        <C server="(local)" SPID="81" t="2017-05-23T18:07:06.247" host="CHS6DAVIDHEN02" ntuser="bbappfx" login="IIS APPPOOL\bbappfx" pname=".Net SqlClient Data Provider" lbatch="2017-05-23T18:07:00.507" logint="2017-05-23T18:07:00.517" lwt="MISCELLANEOUS" myid="70" dbname="BBInfinity_CRM_Integration">
          <SQLInput>(@queues1 nvarchar(4000),@timeout float)delete top (1) from [HangFire].JobQueue with (readpast, updlock, rowlock)
output DELETED.Id, DELETED.JobId, DELETED.Queue
where (FetchedAt is null or FetchedAt &lt; DATEADD(second, @timeout, GETUTCDATE()))
and Queue in (@queues1)</SQLInput>
        </C>
      </SnapShots>
    </S>
  </SnapList>
</SnapLog>